@model APPR_P_2.Models.DonationViewModel
@{
    ViewBag.Title = "Make a Donation";
}

<div class="row">
    <div class="col-12 text-center mb-5">
        <h2>Make a Donation</h2>
        <p class="lead">Your support helps us provide immediate relief to communities affected by disasters</p>
    </div>
</div>

<!-- Call-to-Action Buttons -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card bg-primary text-white text-center py-4">
            <div class="card-body">
                <h3 class="card-title">Every Donation Makes a Difference</h3>
                <p class="card-text">Join thousands of supporters helping communities in crisis</p>
                <div class="mt-4">
                    <button class="btn btn-light btn-lg me-3" data-bs-toggle="modal" data-bs-target="#donationModal">
                        <i class="fas fa-donate me-2"></i>Donate Now
                    </button>
                    <a href="#impact" class="btn btn-outline-light btn-lg">
                        <i class="fas fa-chart-line me-2"></i>See Your Impact
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Donation Impact Statistics -->
<div id="impact" class="row mb-5">
    <div class="col-12">
        <h3 class="mb-4 text-center">Your Donation Impact</h3>
        <div class="row">
            <div class="col-md-3 text-center">
                <div class="stats-box">
                    <div class="stats-number">2,458</div>
                    <div class="stats-label">Donations Received</div>
                </div>
            </div>
            <div class="col-md-3 text-center">
                <div class="stats-box">
                    <div class="stats-number">$1.2M</div>
                    <div class="stats-label">Funds Raised</div>
                </div>
            </div>
            <div class="col-md-3 text-center">
                <div class="stats-box">
                    <div class="stats-number">15,000+</div>
                    <div class="stats-label">People Helped</div>
                </div>
            </div>
            <div class="col-md-3 text-center">
                <div class="stats-box">
                    <div class="stats-number">42</div>
                    <div class="stats-label">Communities Supported</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fundraising Progress -->
<div class="row mb-5">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">Current Fundraising Goal: $100,000</h4>
                <div class="mb-3">
                    <div class="progress donation-progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">
                            <span class="progress-text">$65,000 Raised (65%)</span>
                        </div>
                    </div>
                </div>
                <p class="text-muted">Help us reach our goal by donating today!</p>
            </div>
        </div>
    </div>
</div>

<!-- Donation Options -->
<div class="row mb-5">
    <div class="col-12">
        <h3 class="mb-4 text-center">Ways to Donate</h3>
        <div class="row">
            <div class="col-md-4">
                <div class="card feature-box h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <h4 class="card-title">Financial Donation</h4>
                        <p class="card-text">Make a monetary contribution to support our relief efforts</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#donationModal" data-donation-type="financial">
                            Donate Money
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card feature-box h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <h4 class="card-title">Supplies Donation</h4>
                        <p class="card-text">Donate essential items needed by affected communities</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#donationModal" data-donation-type="supplies">
                            Donate Supplies
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card feature-box h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="fas fa-hand-holding-heart"></i>
                        </div>
                        <h4 class="card-title">Combined Donation</h4>
                        <p class="card-text">Contribute both financially and with needed supplies</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#donationModal" data-donation-type="both">
                            Donate Both
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Donation Form Modal -->
<div class="modal fade" id="donationModal" tabindex="-1" aria-labelledby="donationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="donationModalLabel">Make a Donation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("ProcessDonation", "Donation", FormMethod.Post, new { @class = "needs-validation", novalidate = "true" }))
                {
                    @Html.AntiForgeryToken()

                    @Html.ValidationSummary(true, "", new { @class = "validation-summary-errors" })

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            @Html.LabelFor(m => m.DonorFirstName, new { @class = "form-label" })
                            @Html.TextBoxFor(m => m.DonorFirstName, new { @class = "form-control", required = "required" })
                            @Html.ValidationMessageFor(m => m.DonorFirstName)
                        </div>
                        <div class="col-md-6 mb-3">
                            @Html.LabelFor(m => m.DonorLastName, new { @class = "form-label" })
                            @Html.TextBoxFor(m => m.DonorLastName, new { @class = "form-control", required = "required" })
                            @Html.ValidationMessageFor(m => m.DonorLastName)
                        </div>
                    </div>

                    <div class="mb-3">
                        @Html.LabelFor(m => m.DonorEmail, new { @class = "form-label" })
                        @Html.TextBoxFor(m => m.DonorEmail, new { @class = "form-control", type = "email", required = "required" })
                        @Html.ValidationMessageFor(m => m.DonorEmail)
                    </div>

                    <div class="mb-3">
                        @Html.LabelFor(m => m.DonationType, new { @class = "form-label" })
                        @if (ViewBag.DonationTypes != null)
                        {
                            @Html.DropDownListFor(m => m.DonationType, new SelectList(ViewBag.DonationTypes, "Value", "Text"),
                            "Select Donation Type", new { @class = "form-select", required = "required" })
                                        }
                        else
                        {
                            <select class="form-select" id="DonationType" name="DonationType" required>
                                <option value="">Select Donation Type</option>
                                <option value="financial">Financial Donation</option>
                                <option value="supplies">Supplies Donation</option>
                                <option value="both">Both Financial and Supplies</option>
                            </select>
                        }
                        @Html.ValidationMessageFor(m => m.DonationType)
                    </div>

                    <div id="financialSection">
                        <div class="mb-3">
                            @Html.LabelFor(m => m.DonationAmount, new { @class = "form-label" })
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                @Html.TextBoxFor(m => m.DonationAmount, new { @class = "form-control", type = "number", min = "1", step = "0.01" })
                            </div>
                            @Html.ValidationMessageFor(m => m.DonationAmount)
                        </div>

                        <div class="mb-3">
                            @Html.LabelFor(m => m.PaymentMethod, new { @class = "form-label" })
                            @if (ViewBag.PaymentMethods != null)
                            {
                                @Html.DropDownListFor(m => m.PaymentMethod, new SelectList(ViewBag.PaymentMethods, "Value", "Text"),
                                "Select Payment Method", new { @class = "form-select" })
                                                }
                            else
                            {
                                <select class="form-select" id="PaymentMethod" name="PaymentMethod">
                                    <option value="">Select Payment Method</option>
                                    <option value="creditcard">Credit Card</option>
                                    <option value="paypal">PayPal</option>
                                    <option value="banktransfer">Bank Transfer</option>
                                </select>
                            }
                            @Html.ValidationMessageFor(m => m.PaymentMethod)
                        </div>
                    </div>

                    <div id="suppliesSection">
                        <div class="mb-3">
                            @Html.LabelFor(m => m.Supplies, new { @class = "form-label" })
                            @if (ViewBag.SupplyItems != null)
                            {
                                @Html.ListBoxFor(m => m.Supplies, new MultiSelectList(ViewBag.SupplyItems, "Value", "Text"),
                                new { @class = "form-select", multiple = "multiple", size = "5" })
                                                }
                            else
                            {
                                <select class="form-select" id="Supplies" name="Supplies" multiple size="5">
                                    <option value="water">Bottled Water</option>
                                    <option value="food">Non-perishable Food</option>
                                    <option value="blankets">Blankets</option>
                                    <option value="meds">Medical Supplies</option>
                                    <option value="hygiene">Hygiene Kits</option>
                                    <option value="clothing">Clothing</option>
                                </select>
                            }
                            @Html.ValidationMessageFor(m => m.Supplies)
                        </div>

                        <div class="mb-3">
                            @Html.LabelFor(m => m.AdditionalSupplies, new { @class = "form-label" })
                            @Html.TextAreaFor(m => m.AdditionalSupplies, new { @class = "form-control", rows = "3",
                            placeholder = "Please specify any additional supplies you'd like to donate" })
                        @Html.ValidationMessageFor(m => m.AdditionalSupplies)
                    </div>
                </div>

                <div class="mb-3 form-check">
                    @Html.CheckBoxFor(m => m.DonateAnonymously, new { @class = "form-check-input" })
                    @Html.LabelFor(m => m.DonateAnonymously, new { @class = "form-check-label" })
                </div>

                <div class="mb-3 form-check">
                    @Html.CheckBoxFor(m => m.SubscribeToNewsletter, new { @class = "form-check-input", @checked = "checked" })
                    @Html.LabelFor(m => m.SubscribeToNewsletter, new { @class = "form-check-label" })
                </div>

                <button type="submit" class="btn btn-primary w-100">Process Donation</button>
                                }
            </div>
        </div>
    </div>
</div>

<!-- What Your Donation Provides -->
<div class="row mb-5">
    <div class="col-12">
        <h3 class="mb-4 text-center">What Your Donation Provides</h3>
        <div class="row">
            <div class="col-md-3 text-center">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="card-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <h5 class="card-title">Emergency Food</h5>
                        <p class="card-text">$25 provides emergency food for a family for 3 days</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 text-center">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="card-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <h5 class="card-title">Clean Water</h5>
                        <p class="card-text">$50 provides clean water for 10 people for a week</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 text-center">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="card-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h5 class="card-title">Emergency Shelter</h5>
                        <p class="card-text">$100 provides emergency shelter for a family</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 text-center">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="card-icon">
                            <i class="fas fa-first-aid"></i>
                        </div>
                        <h5 class="card-title">Medical Supplies</h5>
                        <p class="card-text">$250 provides medical supplies for a community</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            // Show/hide form sections based on donation type
            function toggleFormSections() {
                const donationType = $('#DonationType').val();

                if (donationType === 'financial') {
                    $('#financialSection').show();
                    $('#suppliesSection').hide();
                } else if (donationType === 'supplies') {
                    $('#financialSection').hide();
                    $('#suppliesSection').show();
                } else if (donationType === 'both') {
                    $('#financialSection').show();
                    $('#suppliesSection').show();
                } else {
                    $('#financialSection').hide();
                    $('#suppliesSection').hide();
                }
            }

            // Initial state
            toggleFormSections();

            // Update when donation type changes
            $('#DonationType').change(toggleFormSections);

            // Set donation type when buttons are clicked
            $('[data-donation-type]').click(function() {
                const donationType = $(this).data('donation-type');
                $('#DonationType').val(donationType);
                toggleFormSections();
            });

            // Form validation
            (function () {
                'use strict'

                var forms = document.querySelectorAll('.needs-validation')

                Array.prototype.slice.call(forms)
                    .forEach(function (form) {
                        form.addEventListener('submit', function (event) {
                            if (!form.checkValidity()) {
                                event.preventDefault()
                                event.stopPropagation()
                            }

                            form.classList.add('was-validated')
                        }, false)
                    })
            })()
        });
    </script>
}